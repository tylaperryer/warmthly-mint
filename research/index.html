<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#fff6f1" />
  <meta name="color-scheme" content="light" />
  <meta name="viewport" content="width=device-width, initial-scale=0.75, user-scalable=yes" />
  <title>Research - Warmthly</title>
  <link rel="preconnect" href="https://www.warmthly.org">
  <link rel="preconnect" href="https://post.warmthly.org">
  
  <!-- Favicon Set for All Devices -->
  <link rel="icon" type="image/png" sizes="32x32" href="/candle-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/candle-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/candle-apple.png">
  <style>
      /* --- ANTI-FLASH AND PERFORMANCE FIXES --- */
      /* 1. Set base background color immediately to prevent white flash */
      :root {
            color-scheme: light;
      }
      html {
            background-color: #fff6f1;
            min-height: 100%;
      }
      /* 2. Hide body content until fonts are loaded to prevent FOUC/FOUT */
      body {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out;
      }
      /* 3. Fade in smoothly once fonts are ready */
      body.fonts-loaded {
            opacity: 1;
            visibility: visible;
      }
      /* --- END ANTI-FLASH FIXES --- */

      /* Inline critical CSS for faster rendering */
      * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
      }
      
      /* --- FONT DEFINITIONS --- */
      @font-face {
            font-family: 'Cormorant Garamond';
            font-style: normal;
            font-weight: 300 700;
            font-display: swap;
            src: url('/fonts/CormorantGaramond-VariableFont_wght.ttf') format('truetype');
      }
      
      @font-face {
            font-family: 'Cormorant Garamond';
            font-style: italic;
            font-weight: 300 700;
            font-display: swap;
            src: url('/fonts/CormorantGaramond-Italic-VariableFont_wght.ttf') format('truetype');
      }
      
      @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 100 900;
            font-display: swap;
            src: url('/fonts/Inter-VariableFont_opsz,wght.ttf') format('truetype');
      }
      
      @font-face {
            font-family: 'Inter';
            font-style: italic;
            font-weight: 100 900;
            font-display: swap;
            src: url('/fonts/Inter-Italic-VariableFont_opsz,wght.ttf') format('truetype');
      }
      
      html {
            overflow-x: hidden;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
      }
      html::-webkit-scrollbar {
            display: none;
      }
      body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c2c2c;
            background: #fff6f1;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
      }
      body::-webkit-scrollbar {
            display: none;
      }
      
      body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: radial-gradient(circle at 20% 30%, rgba(255,140,66,0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255,182,193,0.12) 0%, transparent 50%),
                        radial-gradient(circle at 40% 70%, rgba(173,216,230,0.1) 0%, transparent 50%),
                        radial-gradient(circle at 90% 80%, rgba(144,238,144,0.08) 0%, transparent 50%),
                        linear-gradient(135deg, #fff6f1 0%, #ffeee6 100%);
            z-index: -1;
            pointer-events: none;
      }
      
      ::selection {
            background: #FF8C42;
            color: #FFFFFF;
      }
      
      .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 20px 40px;
            text-align: center;
            color: #2c2c2c;
            position: relative;
            z-index: 1;
      }
      
      .top-left-heading {
            position: fixed;
            top: 20px;
            left: 20px;
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-weight: 700;
            font-size: 2rem;
            color: #FF8C42;
            user-select: none;
            z-index: 1001;
            text-decoration: none;
      }

      .top-left-heading .warmthly-link {
            text-decoration: none;
            color: #FF8C42;
      }

      .top-left-heading .mint-text {
            color: #33CE79;
            text-decoration: none;
            transition: color 0.3s ease;
      }
      .top-left-heading .mint-text:hover {
            color: #2ab865;
      }
      
      .stoplight-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1002;
      }

      .stoplight {
            --tint-color: rgba(255,255,255,0.15);
            --blur-radius: 12px;
            --border-color: rgba(255,255,255,0.25);
            --highlight-color: rgba(255,255,255,0.4);
            --shadow-color: rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            gap: 3px;
            cursor: pointer;
            padding: 8px;
            position: relative;
            background: var(--tint-color);
            backdrop-filter: blur(var(--blur-radius)) saturate(1.2);
            -webkit-backdrop-filter: blur(var(--blur-radius)) saturate(1.2);
            border: 1px solid var(--border-color);
            border-radius: 14px;
            box-shadow: 0 6px 12px var(--shadow-color),
                        inset 0 1px 1px var(--highlight-color),
                        inset 0 -1px 1px rgba(0,0,0,0.05);
            transition: all 0.4s cubic-bezier(0.25,0.8,0.25,1);
            overflow: hidden;
      }

      .stoplight::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            pointer-events: none;
            z-index: 1;
            opacity: 0.7;
            transition: opacity 0.4s cubic-bezier(0.25,0.8,0.25,1);
      }

      .stoplight:hover,
      .stoplight.active {
            background: rgba(255,255,255,0.25);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12),
                        inset 0 1px 1px rgba(255,255,255,0.5),
                        inset 0 -1px 1px rgba(0,0,0,0.1);
      }

      .stoplight:hover::before,
      .stoplight.active::before {
            opacity: 1;
      }

      .stoplight-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            position: relative;
            transition: opacity 0.4s cubic-bezier(0.25,0.8,0.25,1);
            z-index: 2;
            opacity: 0.3;
      }

      .stoplight-dot.red { background: #ff4757; }
      .stoplight-dot.yellow { background: #FF8C42; }
      .stoplight-dot.green { background: #2ed573; }

      .stoplight-container:hover .stoplight-dot.red,
      .stoplight.active .stoplight-dot.red { animation: stoplight-cycle-red 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }
      .stoplight-container:hover .stoplight-dot.green,
      .stoplight.active .stoplight-dot.green { animation: stoplight-cycle-green 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }
      .stoplight-container:hover .stoplight-dot.yellow,
      .stoplight.active .stoplight-dot.yellow { animation: stoplight-cycle-yellow 10s cubic-bezier(0.25,0.8,0.25,1) infinite; }

      @keyframes stoplight-cycle-red { 0%, 33.33% { opacity: 1; } 33.34%, 100% { opacity: 0.3; } }
      @keyframes stoplight-cycle-green { 0%, 33.33% { opacity: 0.3; } 33.34%, 66.66% { opacity: 1; } 66.67%, 100% { opacity: 0.3; } }
      @keyframes stoplight-cycle-yellow { 0%, 66.66% { opacity: 0.3; } 66.67%, 100% { opacity: 1; } }

      .dropdown-menu {
            --tint-color: rgba(255,255,255,0.15);
            --blur-radius: 12px;
            --border-color: rgba(255,255,255,0.25);
            --highlight-color: rgba(255,255,255,0.4);
            --shadow-color: rgba(0,0,0,0.08);
            --text-color: #1c2526;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--tint-color);
            backdrop-filter: blur(var(--blur-radius)) saturate(1.2);
            -webkit-backdrop-filter: blur(var(--blur-radius)) saturate(1.2);
            border-radius: 18px;
            padding: 8px;
            margin-top: 12px;
            min-width: 200px;
            box-shadow: 0 8px 32px var(--shadow-color),
                        inset 0 1px 1px var(--highlight-color),
                        inset 0 -1px 1px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-12px) scale(0.94);
            transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
            overflow: hidden;
      }

      .dropdown-menu::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(255,255,255,0.25), rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            pointer-events: none;
            z-index: 1;
            opacity: 0.7;
      }

      .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
      }

      .dropdown-item {
            display: block;
            padding: 12px 16px;
            margin: 2px 0;
            color: var(--text-color);
            text-decoration: none;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.25,0.8,0.25,1);
            border-radius: 10px;
            position: relative;
            z-index: 2;
      }

      .dropdown-item:hover { color: #FF8C42; }
      .dropdown-item:first-child { margin-top: 0; }
      .dropdown-item:last-child { margin-bottom: 0; }
      
      .page-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.8rem;
            color: #FF8C42;
            margin-bottom: 2rem;
            font-weight: 600;
            text-align: center;
            letter-spacing: 0.02em;
      }

      /* Books in a line */
      .books-container {
            margin: 3rem 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
      }

      .books-row {
            display: flex;
            gap: 1.5rem;
            align-items: flex-end;
            padding: 0 2rem;
            margin-bottom: 0.5rem;
      }

      .book-item {
            cursor: default;
            transition: transform 0.3s ease;
            padding: 0;
            background: none;
            border: none;
            pointer-events: none;
            filter: grayscale(100%);
            opacity: 0.6;
      }

      .book-item:hover {
            transform: none;
      }

      .book-emoji {
            font-size: 2.5rem;
            line-height: 1;
            display: block;
      }

      /* Bookshelf bar */
      .bookshelf-bar {
            width: 100%;
            height: 20px;
            background: linear-gradient(to bottom, rgba(139, 69, 19, 0.3) 0%, rgba(101, 67, 33, 0.4) 50%, rgba(139, 69, 19, 0.5) 100%);
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1), inset 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 0.5rem;
      }

      /* Popup Modal */
      .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
      }

      .popup-overlay.active {
            display: flex;
            opacity: 1;
      }

      .popup-content {
            background: #fff6f1;
            border-radius: 20px;
            padding: 0;
            max-width: 1000px;
            max-height: 85vh;
            width: 90%;
            overflow: hidden;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
      }

      .popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #2c2c2c;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
      }

      .popup-close:hover {
            background: #FF8C42;
            color: white;
            transform: scale(1.1);
      }

      /* Two-page layout */
      .popup-page {
            flex: 1;
            padding: 3rem;
            overflow-y: auto;
            position: relative;
            background: #fff6f1 url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            background-size: 200px 200px;
      }

      .popup-page.left-page {
            border-right: 2px solid rgba(255,140,66,0.2);
            border-radius: 20px 0 0 20px;
      }

      .popup-page.right-page {
            border-radius: 0 20px 20px 0;
            cursor: default;
      }

      /* Clickable corner on right page */
      .page-corner {
            position: absolute;
            top: 0;
            right: 0;
            width: 80px;
            height: 80px;
            cursor: pointer;
            z-index: 5;
            background: linear-gradient(135deg, transparent 0%, transparent 50%, rgba(255,140,66,0.1) 50%, rgba(255,140,66,0.1) 100%);
            transition: background 0.2s ease;
      }

      .page-corner:hover {
            background: linear-gradient(135deg, transparent 0%, transparent 50%, rgba(255,140,66,0.2) 50%, rgba(255,140,66,0.2) 100%);
      }

      .popup-page-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: #FF8C42;
            margin-bottom: 1.5rem;
            font-weight: 700;
      }

      .popup-page-text {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            color: #2c2c2c;
            line-height: 1.7;
            margin-bottom: 2rem;
      }

      .popup-image-placeholder {
            width: 100%;
            height: 200px;
            background: rgba(255,140,66,0.1);
            border: 2px dashed rgba(255,140,66,0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FF8C42;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 1rem;
      }

      .popup-page::-webkit-scrollbar {
            width: 8px;
      }

      .popup-page::-webkit-scrollbar-track {
            background: rgba(255,140,66,0.1);
            border-radius: 4px;
      }

      .popup-page::-webkit-scrollbar-thumb {
            background: rgba(255,140,66,0.3);
            border-radius: 4px;
      }

      .popup-page::-webkit-scrollbar-thumb:hover {
            background: rgba(255,140,66,0.5);
      }

      @media (max-width: 768px) {
            .container {
                  padding-top: 80px;
                  padding-left: 15px;
                  padding-right: 15px;
            }
            .top-left-heading {
                  font-size: 1.6rem;
                  top: 15px;
                  left: 15px;
            }
            .page-title { font-size: 1.5rem; }
            .books-row {
                  gap: 1rem;
                  padding: 0 1rem;
            }
            .book-emoji {
                  font-size: 2rem;
            }
            .bookshelf-bar {
                  height: 15px;
            }
            .popup-content {
                  flex-direction: column;
                  max-height: 90vh;
            }
            .popup-page {
                  padding: 2rem 1.5rem;
                  border-right: none;
                  border-bottom: 2px solid rgba(255,140,66,0.2);
                  border-radius: 0;
            }
            .popup-page.left-page {
                  border-radius: 20px 20px 0 0;
            }
            .popup-page.right-page {
                  border-radius: 0 0 20px 20px;
            }
            .popup-page-title {
                  font-size: 1.5rem;
            }
            .page-corner {
                  width: 60px;
                  height: 60px;
            }
      }
      
      .preload-fonts {
            font-family: 'Cormorant Garamond';
            font-family: 'Inter';
            visibility: hidden;
            position: absolute;
      }
  </style>
  
  
  <link rel="dns-prefetch" href="//warmthly.org">
</head>
<body class="fonts-loading">
  <div class="preload-fonts">.</div>
  
  <div class="top-left-heading">
    <a href="https://www.warmthly.org" class="warmthly-link">Warmthly</a>
    <a href="https://mint.warmthly.org" class="mint-text">Mint</a>
  </div>
  
  <div class="stoplight-container">
    <div class="stoplight" id="stoplight">
      <div class="stoplight-dot red"></div>
      <div class="stoplight-dot yellow"></div>
      <div class="stoplight-dot green"></div>
    </div>
    
    <div class="dropdown-menu" id="dropdown-menu">
      <a href="https://www.warmthly.org" class="dropdown-item">Home</a>
      <a href="https://mint.warmthly.org" class="dropdown-item">Mint</a>
      <a href="https://post.warmthly.org" class="dropdown-item">Post</a>
    </div>
  </div>

  <div class="container">
    <h1 class="page-title">Research & Methods</h1>
    <p style="font-family: 'Inter', sans-serif; font-size: 1.1rem; margin-bottom: 3rem; opacity: 0.85; color: #2c2c2c; line-height: 1.7; text-align: center;">
      Under construction. Our methods will be posted as soon as we have them ready.
    </p>
    
    <div class="books-container">
      <div class="books-row" id="booksRow">
        <!-- Books will be rendered here -->
      </div>
      <div class="bookshelf-bar"></div>
    </div>
  </div>

  <!-- Popup Modal -->
  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-content">
      <button class="popup-close" id="popupClose">Ã—</button>
      <div class="popup-page left-page" id="leftPage">
        <h2 class="popup-page-title" id="leftPageTitle">Left Page Title</h2>
        <div class="popup-page-text" id="leftPageText">
          <!-- Left page text content -->
        </div>
        <div class="popup-image-placeholder" id="leftPageImage">
          Image placeholder - Add your image here
        </div>
      </div>
      <div class="popup-page right-page" id="rightPage">
        <div class="page-corner" id="pageCorner"></div>
        <h2 class="popup-page-title" id="rightPageTitle">Right Page Title</h2>
        <div class="popup-page-text" id="rightPageText">
          <!-- Right page text content -->
        </div>
        <div class="popup-image-placeholder" id="rightPageImage">
          Image placeholder - Add your image here
        </div>
      </div>
    </div>
  </div>

  <script>
      // Book data with pages/spreads
      const booksData = [
            {
                  id: 1,
                  title: "Our Method",
                  emoji: "ðŸ“—",
                  pages: [
                        {
                              left: {
                                    title: "Our Method",
                                    text: "This is placeholder text for the left page of Our Method. You can add your content here, including descriptions, details, and any information you want to share.",
                                    image: null
                              },
                              right: {
                                    title: "Step 1: Introduction",
                                    text: "This is placeholder text for the right page. Add more content about the first step of your method here.",
                                    image: null
                              }
                        },
                        {
                              left: {
                                    title: "Step 2: Implementation",
                                    text: "This is the left page of the second spread. Add content about implementation here.",
                                    image: null
                              },
                              right: {
                                    title: "Step 3: Results",
                                    text: "This is the right page of the second spread. Add content about results here.",
                                    image: null
                              }
                        }
                  ]
            },
            {
                  id: 2,
                  title: "Empathy Design",
                  emoji: "ðŸ“˜",
                  pages: [
                        {
                              left: {
                                    title: "Empathy Design",
                                    text: "This is placeholder text for Empathy Design. Add your content about empathy design principles here.",
                                    image: null
                              },
                              right: {
                                    title: "Core Principles",
                                    text: "Add information about the core principles of empathy design on this right page.",
                                    image: null
                              }
                        }
                  ]
            },
            {
                  id: 3,
                  title: "Measurement",
                  emoji: "ðŸ“™",
                  pages: [
                        {
                              left: {
                                    title: "Measurement",
                                    text: "This is placeholder text for Measurement. Include information about your measurement framework here.",
                                    image: null
                              },
                              right: {
                                    title: "Metrics & Analysis",
                                    text: "Add details about metrics and analysis methods on this right page.",
                                    image: null
                              }
                        }
                  ]
            }
      ];

      // Current book and page state
      let currentBook = null;
      let currentPageIndex = 0;

      // Generate books
      function generateBooks() {
            const container = document.getElementById('booksRow');
            container.innerHTML = '';
            
            booksData.forEach(book => {
                  const bookElement = document.createElement('div');
                  bookElement.className = 'book-item';
                  bookElement.innerHTML = `<div class="book-emoji">${book.emoji}</div>`;
                  // Removed click handler - books are now unclickable
                  container.appendChild(bookElement);
            });
      }

      // Open popup
      function openPopup(book) {
            currentBook = book;
            currentPageIndex = 0;
            
            const overlay = document.getElementById('popupOverlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            renderPage();
      }

      // Render current page spread
      function renderPage() {
            if (!currentBook || !currentBook.pages || currentPageIndex >= currentBook.pages.length) {
                  return;
            }
            
            const spread = currentBook.pages[currentPageIndex];
            
            // Left page
            const leftTitle = document.getElementById('leftPageTitle');
            const leftText = document.getElementById('leftPageText');
            const leftImage = document.getElementById('leftPageImage');
            
            leftTitle.textContent = spread.left.title;
            leftText.textContent = spread.left.text;
            
            if (spread.left.image) {
                  leftImage.textContent = '';
                  const img = document.createElement('img');
                  img.src = spread.left.image;
                  // Create descriptive alt text combining title and context
                  const altText = spread.left.title 
                    ? `Image for ${spread.left.title}` 
                    : 'Research page image';
                  img.alt = altText;
                  img.loading = 'lazy';
                  img.decoding = 'async';
                  img.style.maxWidth = '100%';
                  img.style.height = 'auto';
                  img.style.borderRadius = '8px';
                  // Add error handling for failed image loads
                  img.onerror = function() {
                    this.style.display = 'none';
                    leftImage.textContent = 'Image failed to load';
                  };
                  leftImage.appendChild(img);
            } else {
                  leftImage.textContent = 'Image placeholder - Add your image here';
            }
            
            // Right page
            const rightTitle = document.getElementById('rightPageTitle');
            const rightText = document.getElementById('rightPageText');
            const rightImage = document.getElementById('rightPageImage');
            
            rightTitle.textContent = spread.right.title;
            rightText.textContent = spread.right.text;
            
            if (spread.right.image) {
                  rightImage.textContent = '';
                  const img = document.createElement('img');
                  img.src = spread.right.image;
                  // Create descriptive alt text combining title and context
                  const altText = spread.right.title 
                    ? `Image for ${spread.right.title}` 
                    : 'Research page image';
                  img.alt = altText;
                  img.loading = 'lazy';
                  img.decoding = 'async';
                  img.style.maxWidth = '100%';
                  img.style.height = 'auto';
                  img.style.borderRadius = '8px';
                  // Add error handling for failed image loads
                  img.onerror = function() {
                    this.style.display = 'none';
                    rightImage.textContent = 'Image failed to load';
                  };
                  rightImage.appendChild(img);
            } else {
                  rightImage.textContent = 'Image placeholder - Add your image here';
            }
      }

      // Turn to next page
      function turnPage() {
            if (!currentBook || !currentBook.pages) return;
            
            if (currentPageIndex < currentBook.pages.length - 1) {
                  currentPageIndex++;
                  renderPage();
            }
      }

      // Close popup
      function closePopup() {
            const overlay = document.getElementById('popupOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
      }

      // Event listeners
      document.getElementById('popupClose').addEventListener('click', closePopup);
      document.getElementById('popupOverlay').addEventListener('click', (e) => {
            if (e.target.id === 'popupOverlay') {
                  closePopup();
            }
      });
      
      // Page corner click to turn page
      document.getElementById('pageCorner').addEventListener('click', (e) => {
            e.stopPropagation();
            turnPage();
      });

      // Stoplight menu functionality
      const stoplight = document.getElementById('stoplight');
      const dropdownMenu = document.getElementById('dropdown-menu');
      let isMenuOpen = false;

      function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            stoplight.classList.toggle('active', isMenuOpen);
            dropdownMenu.classList.toggle('active', isMenuOpen);
      }

      stoplight.addEventListener('click', (e) => {
            e.stopPropagation();
            toggleMenu();
      });

      document.addEventListener('click', (e) => {
            if (!stoplight.contains(e.target) && !dropdownMenu.contains(e.target) && isMenuOpen) {
                  toggleMenu();
            }
      });

      document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                  if (isMenuOpen) {
                        toggleMenu();
                  }
                  closePopup();
            }
      });

      dropdownMenu.addEventListener('click', (e) => {
            e.stopPropagation();
      });

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
            generateBooks();
      });
  </script>
  
  <script>
    // --- NATIVE FONT LOADING ---
    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(() => {
        document.body.classList.remove('fonts-loading');
        document.body.classList.add('fonts-loaded');
      });
      
      // Fallback timeout
      setTimeout(() => {
        document.body.classList.remove('fonts-loading');
        document.body.classList.add('fonts-loaded');
      }, 3000);
    } else {
      // Fallback for older browsers
      document.body.classList.remove('fonts-loading');
      document.body.classList.add('fonts-loaded');
    }
    // --- END FONT LOADING ---
  </script>
</body>
</html>
